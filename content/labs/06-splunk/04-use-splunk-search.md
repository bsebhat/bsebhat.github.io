---
title: 04 Use Splunk Search
type: docs
---

Currently, the access logs form the web app running on `juiceshop` are being forwarded to the Splunk Enterprise server running on `splunk`.

## Splunk Search
And I can use the `soc-analyst` VM to log in to the Splunk web portal at `http://splunk:8000` and view the log data using the Search & Reporting app. It's easier than reading the log files on the `juiceshop` server.

When I configured the Splunk Forwarder on `juiceshop`, I created a configuration file called `inputs.conf` with this:
```
[monitor:///opt/juice-shop/logs/access*]
index = juiceshop
```

So when I open the Search app at `http://splunk:8000/en-US/app/search/search`, I can go to the search field and enter `index='juiceshop'` to search the access log data that was forwarded from `juiceshop` to that index.

## Access Log Data on juiceshop
TODO: Show an example of a juiceshop access log entry
The "sourcetype" for this access log data is "access_log". Splunk uses sourcetypes to determine how to ingest, analyze, and visualize the data being forwarded to it. I didn't specify in the `inputs.conf` file what type of sourcetype those access logs will be. If I look at the events in Splunk, there are many parts of the log entry that aren't being parsed/seperated by Splunk. Some important fields like HTTP method and status code.

TODO: add screenshot of access_log event in Splunk

## Improve Splunk Event View
If I want Splunk to display the log data entries with most of their fields seperated as fields, I can specify the specific sourcetype. The access logs being generated by the juice-shop web application are "combined" log format. That format is:
```
"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"
```

I can modify the `/opt/splunkforwarder/etc/system/local/inputs.conf` Splunk Forwarder config file on `juiceshop` to say the log data is in the `access_combined` sourcetype:
```
[monitor:///opt/juice-shop/logs/access*]
index = juiceshop
sourcetype = access_combined
```

Now, when I use the juice-shop web app to create new log data, and check the Splunk search app again for the same `juice-shop` index, the new log events have the sourcetype `access_combined`, and they're parsed to look like this:
TODO: insert screenshot of log event with access_combined sourcetype

This helps users to easily see fields in the log events, and they can easily be used to search and create alerts. For example, you can see the HTTP status code is extracted when the sourcetype is `access_combined`. That can be used to filter events for specific error codes during a security incident investigation. If you look on the "Interesting Fields" list on the left, there are options to filter by "Status". There are two types that were found in the search results: [200 OK](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200) and [401 Unauthorized](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401). In a situation where a user may have been attempting to gain unauthorized access, or performing reconnasaince, having your log data sourcetypes "fine-tuned" in advance can save you the time of pouring through log data entries or creating regular expression filters.