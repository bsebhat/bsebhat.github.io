---
title: 01 Use badjuicer To Exploit
type: docs
---

To create the `badjuicer`, I just clone the `template-archlinux` VM. It will be connected to the `default` network, like the `juciefan` VM.

I'm going to use this `badjuicer` VM to exploit some of the [built-in vulnerabilities](https://pwning.owasp-juice.shop/companion-guide/latest/appendix/solutions.html) of the Juice Shop web application. The vulnerabilities are considered "challenges" that test the skills of penetration testers. Some challenges are considered easier, and have a "one star" score. The more difficult the exploit, the more stars.

They are also organized into [vulnerability categories](https://owasp.org/www-project-juice-shop/#div-challenges), like "Broken Authentication" and "Improper Input Validation".

## Install Burp Suite
For some of the exploits, I'll be using a penetration testing tool called [Burp Suite](https://portswigger.net/burp/). I'll install the community edition aur package:
```
yay -S burpsuite
```

## Exploit Juice Shop Web App
The Juice Shop web application was built by OWASP to demonstrate some of the most common web application vulnerabilities. I've picked an exploit I found on the official OWASP challenge solutions page: [Put an additional product into another userâ€™s shopping basket](https://pwning.owasp-juice.shop/companion-guide/latest/appendix/solutions.html#_put_an_additional_product_into_another_users_shopping_basket)

### Open Burp Suite Proxy
With the `badjuicer` machine, I'll start Burp Suite, click the `Proxy / Intercept` button, Click the `Open Browser` button, and go to the Juice Shop website:
![badjuicer burpsuite](../badjuicer-burpsuite.png)

### Create Account
I create a new account:
![badjuicer-account](../badjuicer-account.png)

### Add Product To badjuicer Basket
Before I add an apple juice to my basket, I'll click the `Interceptor is off` button to turn it on. The Interceptor will intercept all the HTTP requests I send and receive.
![turn on intercept](../turn-on-intercept.png)

In the browser, I click the `Add to Basket` button under Apple Juice, and the page freezes. In the Interceptor, I click the `Forward` button to get to the HTTP request telling the server to add the Apple Juice product to my basket:
![intercept basket http](../intercept-basket-http.png)

It's sending a `POST /api/BasketItems/` with this payload to the Juice Shop website:
```json
{"ProductId":1,"BasketId":"7","quantity":1}
```

With this `POST` HTTP request, the browser is telling the web application on the server to add the apple juice product (`ProductId`) to the basket (`BasketId` ).

I turn the Interceptor off to let the HTTP requests continue, and start looking at other products.

### Add Product In Other User's Basket
Let's try that again with this $3000 "Melon Bike":
![bike product](../bike-product.png)

Turning the Intercept back on, and clicking the "Add to Basket" button for the "Melon Bike", the request is paused.

Clicking "Forward" a few times gets back to that `POST /api/BasketItems/` post. This time, I click the "Action" button, select the `Change body encoding`, and change the `BasketId` from 7 to 6:
![change basket](../change-basket.png)

But when I look at the HTTP history, that `POST /api/BasketItems/` request returned a `401 Unauthorized` error. Because I had an invalid `BasketId`:
![response basket invalid](../response-basket-invalid.png)

I repeat the same steps: turn Interceptor on, add "Melon Bike" to basket, forward to the `POST /api/BasketItems/` request.

But this time, I modify the payload to include two `BasketId`s. First, the `BasketId` of 7 that belongs to `badjuicer`. And the second `BasketId` of 6 that belongs to `juicefan`:
```
{"ProductId":33,"BasketId":"7", "BasketId":"6", "quantity":1}
```

It returns a `200 OK`, with the `juicefan` `BasketId` of 6. 
![success basketid change](../success-basketid-change.png)

So now I submitted the $3000 "Melon Bike" to the user with the `BasketId` of 6, `juicefan`.

## juicefan Email To sysadmin

And so now, the `juicefan` wakes up, opens their computer, goes to the Juice Shop website to checkout their basket and finds a $3000 bike was added:
![juicefan bike basket](../juicefan-bike-basket.png)

So `juicefan` sends this email to the `sysadmin`:

```
From: juicefan
To: sysadmin

Dear Juice Shop,

I'm a hug fan of your website.
I love drinking juice.
But I just found a $3000 bike added to my basket!
I love juice, but I hate riding bikes.
I've been hacked.
I have been a loyal customer for like 3 days. Please fix this!

Sincerely,
Juice Fan
```

## sysadmin Investigates Access Logs
So now `sysadmin` needs to SSH into the `juiceshop` web server, get sudo access to go into the `/opt/juice-shop/logs` directory, and go through the access logs for the web application and try to understand what happened.
![sysadmin logs](../sysadmin-logs.png)

Opening the access log for today, `access.log.2023-10-23`, there are over 500 lines.
![access log today](../access-log-today.png)

That's going to be tough.

## syadmin Adds a SOC
To help monitor for future security incidents like this, a security operations center (SOC) will be added to the network. A separate `SOC` network will be added, like with `DMZ`. And a `soc-analyst` desktop VM similar to `sysadmin` will be added. That will be used to access a server running a Splunk server that takes all the log data and makes it easy to access and analyze.